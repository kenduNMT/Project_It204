<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tìm việc làm - Ứng viên</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .sidebar {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar .nav-link {
      color: rgba(255, 255, 255, 0.8);
      padding: 12px 20px;
      margin: 5px 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .sidebar .nav-link:hover, .sidebar .nav-link.active {
      color: white;
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(5px);
    }

    .navbar-brand {
      font-weight: bold;
      color: #667eea !important;
    }

    .header-card {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white;
      border-radius: 15px;
    }

    .job-card {
      border-radius: 15px;
      border: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .job-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px 15px 0 0;
    }

    .company-logo {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
    }

    .salary-badge {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border-radius: 20px;
      padding: 5px 15px;
      font-weight: 500;
    }

    .urgent-badge {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: white;
      border-radius: 20px;
      padding: 5px 15px;
      font-weight: 500;
    }

    .search-card {
      border-radius: 15px;
      border: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .btn-apply {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      border: none;
      border-radius: 25px;
      color: white;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-apply:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      color: white;
    }

    .btn-save {
      background: #ffc107;
      border: none;
      border-radius: 25px;
      color: #000;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-save:hover {
      background: #e0a800;
      transform: translateY(-2px);
      color: #000;
    }

    .filter-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .job-tags .badge {
      margin: 2px;
      padding: 5px 10px;
      font-size: 0.75rem;
    }

    .pagination .page-link {
      border-radius: 10px;
      margin: 0 2px;
      border: none;
      color: #667eea;
    }

    .pagination .page-item.active .page-link {
      background: #667eea;
      border-color: #667eea;
    }

    .job-meta {
      font-size: 0.9rem;
      color: #6c757d;
    }

    .location-badge {
      background: #6c757d;
      color: white;
      border-radius: 15px;
      padding: 3px 10px;
      font-size: 0.8rem;
    }

    .experience-badge {
      background: #17a2b8;
      color: white;
      border-radius: 15px;
      padding: 3px 10px;
      font-size: 0.8rem;
    }

    .filter-badge {
      background: #e9ecef;
      color: #495057;
      border: none;
      margin: 2px;
    }

    .filter-badge.active {
      background: #667eea;
      color: white;
    }

    .saved-job {
      position: relative;
    }

    .saved-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      color: #ffc107;
    }

    .quick-stats {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
    }

    .job-card {
      transition: transform 0.3s;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .job-title {
      color: #2c3e50;
      font-weight: 600;
    }
    .company-name {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    .badge-custom {
      background-color: #e74c3c;
      color: white;
    }
    .search-box {
      margin-bottom: 30px;
    }
    .expired-badge {
      background: #dc3545;
      color: white;
    }
    .active-badge {
      background: #28a745;
      color: white;
    }
  </style>
</head>
<body class="bg-light">
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><i class="fas fa-briefcase"></i> JobPortal</a>
    <div class="navbar-nav ms-auto">
      <div class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
          <i class="fas fa-user-circle"></i> <span
                th:text="${session.candidateName ?: 'Ứng viên'}">Ứng viên</span>
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" th:href="@{/candidate/profile}"><i class="fas fa-user"></i> Thông tin
            cá nhân</a></li>
          <li><a class="dropdown-item" th:href="@{/candidate/change-password}"><i class="fas fa-key"></i> Đổi
            mật khẩu</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" th:href="@{/auth/logout}"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 px-0">
      <div class="sidebar">
        <div class="p-3 text-center">
          <img src="https://via.placeholder.com/80x80/ffffff/667eea?text=Avatar"
               class="rounded-circle mb-2" alt="Avatar">
          <h6 class="text-white" th:text="${session.candidateName ?: 'Ứng viên'}">Ứng viên</h6>
          <small class="text-white-50" th:text="${session.candidateEmail ?: 'email@example.com'}">email@example.com</small>
        </div>

        <nav class="nav nav-pills flex-column">
          <a class="nav-link" th:href="@{/candidate/dashboard}">
            <i class="fas fa-tachometer-alt me-2"></i> Trang chủ
          </a>
          <a class="nav-link" th:href="@{/candidate/profile}">
            <i class="fas fa-user me-2"></i> Thông tin cá nhân
          </a>
          <a class="nav-link active" th:href="@{/candidate/jobs}">
            <i class="fas fa-search me-2"></i> Tìm việc làm
          </a>
          <a class="nav-link" th:href="@{/candidate/applications}">
            <i class="fas fa-file-alt me-2"></i> Đơn ứng tuyển
          </a>
        </nav>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 col-lg-10">
      <div class="p-4">
        <!-- Header -->
        <div class="header-card p-4 mb-4">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h2><i class="fas fa-search me-3"></i>Tìm việc làm</h2>
              <p class="mb-0">Khám phá các cơ hội nghề nghiệp phù hợp với bạn</p>
            </div>
            <div class="col-md-4 text-end">
                                <span class="badge bg-light text-dark fs-6">
                                    <i class="fas fa-briefcase me-2"></i><span id="jobCount" th:text="${totalElements ?: 0}">125</span> việc làm
                                </span>
            </div>
          </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="search-card card p-4 mb-4">
          <form id="jobSearchForm" th:action="@{/candidate/jobs}" method="get">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label"><i class="fas fa-search me-2"></i>Từ khóa</label>
                <input type="text" class="form-control" id="keyword" name="keyword"
                       th:value="${keyword}"
                       placeholder="Nhập vị trí công việc...">
              </div>
              <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary w-100">
                  <i class="fas fa-search me-2"></i>Tìm kiếm
                </button>
              </div>
            </div>
          </form>

          <!-- Advanced Filters -->
          <div class="filter-section mt-3">
            <h6 class="mb-3"><i class="fas fa-filter me-2"></i>Bộ lọc nâng cao</h6>

            <!-- Salary Range -->
            <div class="mb-3">
              <label class="form-label">Mức lương (triệu VND)</label>
              <div class="btn-group" role="group">
                <input type="radio" class="btn-check" name="salary" id="salary1" value="0-10">
                <label class="btn btn-outline-secondary btn-sm filter-badge" for="salary1">Dưới 10
                  triệu</label>

                <input type="radio" class="btn-check" name="salary" id="salary2" value="10-20">
                <label class="btn btn-outline-secondary btn-sm filter-badge" for="salary2">10-20
                  triệu</label>

                <input type="radio" class="btn-check" name="salary" id="salary3" value="20-30">
                <label class="btn btn-outline-secondary btn-sm filter-badge" for="salary3">20-30
                  triệu</label>

                <input type="radio" class="btn-check" name="salary" id="salary4" value="30+">
                <label class="btn btn-outline-secondary btn-sm filter-badge" for="salary4">Trên 30
                  triệu</label>
              </div>
            </div>

            <!-- Experience Level -->
            <div class="mb-3">
              <label class="form-label">Kinh nghiệm</label>
              <div class="btn-group" role="group">
                <input type="radio" class="btn-check" name="experience" id="exp1" value="0">
                <label class="btn btn-outline-info btn-sm filter-badge" for="exp1">Chưa có kinh
                  nghiệm</label>

                <input type="radio" class="btn-check" name="experience" id="exp2" value="1-2">
                <label class="btn btn-outline-info btn-sm filter-badge" for="exp2">1-2 năm</label>

                <input type="radio" class="btn-check" name="experience" id="exp3" value="3-5">
                <label class="btn btn-outline-info btn-sm filter-badge" for="exp3">3-5 năm</label>

                <input type="radio" class="btn-check" name="experience" id="exp4" value="5+">
                <label class="btn btn-outline-info btn-sm filter-badge" for="exp4">Trên 5 năm</label>
              </div>
            </div>

            <div class="text-end">
              <button type="button" class="btn btn-outline-secondary btn-sm me-2"
                      onclick="clearFilters()">
                <i class="fas fa-times me-1"></i>Xóa bộ lọc
              </button>
              <button type="button" class="btn btn-primary btn-sm" onclick="applyFilters()">
                <i class="fas fa-check me-1"></i>Áp dụng
              </button>
            </div>
          </div>
        </div>

        <!-- Sort and View Options -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
                        <span class="text-muted">Hiển thị <strong id="showingCount" th:text="${jobs != null ? jobs.size() : 0}">0</strong> trong <strong
                                id="totalCount" th:text="${totalElements ?: 0}">0</strong> kết quả</span>
          </div>
          <div class="d-flex align-items-center">
            <label class="form-label me-2 mb-0">Sắp xếp:</label>
            <select class="form-select form-select-sm" id="sortBy" style="width: auto;">
              <option value="newest">Mới nhất</option>
              <option value="salary-high">Lương cao nhất</option>
              <option value="salary-low">Lương thấp nhất</option>
              <option value="deadline">Gần hết hạn</option>
            </select>
          </div>
        </div>

        <!-- Job List -->
        <div class="row" th:if="${jobs != null and !jobs.empty}">
          <div th:each="job : ${jobs}" class="col-md-6 col-lg-4">
            <div class="card job-card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h5 class="card-title job-title" th:text="${job.name}">Job Title</h5>
                  <div>
                    <!-- Hiển thị trạng thái active/expired -->
                    <span th:if="${job.active}" class="badge active-badge">Đang tuyển</span>
                    <span th:unless="${job.active}" class="badge expired-badge">Hết hạn</span>
                  </div>
                </div>

                <!-- Mô tả công việc -->
                <p class="text-muted small mb-2" th:text="${#strings.abbreviate(job.description, 100)}">Job Description</p>

                <!-- Mức lương -->
                <div class="mb-2" th:if="${job.minSalary != null or job.maxSalary != null}">
                  <span class="text-muted"><i class="fas fa-money-bill-wave me-1"></i></span>
                  <span class="salary-badge">
                                        <span th:if="${job.minSalary != null and job.maxSalary != null}"
                                              th:text="${job.minSalary + ' - ' + job.maxSalary + ' triệu'}">Salary Range</span>
                                        <span th:if="${job.minSalary != null and job.maxSalary == null}"
                                              th:text="'Từ ' + ${job.minSalary} + ' triệu'">Min Salary</span>
                                        <span th:if="${job.minSalary == null and job.maxSalary != null}"
                                              th:text="'Tối đa ' + ${job.maxSalary} + ' triệu'">Max Salary</span>
                                    </span>
                </div>
                <div class="mb-2" th:if="${job.minSalary == null and job.maxSalary == null}">
                  <span class="text-muted"><i class="fas fa-money-bill-wave me-1"></i></span>
                  <span class="badge bg-secondary">Thỏa thuận</span>
                </div>

                <!-- Kinh nghiệm yêu cầu -->
                <div class="mb-2" th:if="${job.minExperience != null}">
                  <span class="text-muted"><i class="fas fa-briefcase me-1"></i></span>
                  <span class="experience-badge" th:text="${job.minExperience == 0 ? 'Chưa cần kinh nghiệm' : job.minExperience + '+ năm kinh nghiệm'}">Experience</span>
                </div>

                <!-- Công nghệ yêu cầu -->
                <div class="mb-3" th:if="${job.technologies != null and !job.technologies.empty}">
                                    <span th:each="tech : ${job.technologies}"
                                          class="badge bg-light text-dark me-1 mb-1"
                                          th:text="${tech.name}">Tech</span>
                </div>

                <!-- Ngày đăng và ngày hết hạn -->
                <div class="job-meta mb-3">
                  <div th:if="${job.createdDate != null}">
                    <small class="text-muted">
                      <i class="fas fa-calendar-plus me-1"></i>
                      Đăng: <span th:text="${#dates.format(job.createdDate, 'dd/MM/yyyy')}">Posted Date</span>
                    </small>
                  </div>
                  <div th:if="${job.expiredDate != null}">
                    <small class="text-muted">
                      <i class="fas fa-calendar-times me-1"></i>
                      Hết hạn: <span th:text="${#dates.format(job.expiredDate, 'dd/MM/yyyy')}">Expired Date</span>
                    </small>
                  </div>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <button type="button" class="btn btn-sm btn-outline-warning me-1"
                            th:onclick="'saveJob(' + ${job.id} + ')'">
                      <i class="fas fa-heart"></i>
                    </button>
                  </div>
                  <div>
                    <a th:href="@{'/candidate/jobs/' + ${job.id}}" class="btn btn-sm btn-outline-primary me-1">
                      <i class="fas fa-eye"></i> Chi tiết
                    </a>
                    <button type="button" class="btn btn-sm btn-primary"
                            th:onclick="'quickApply(' + ${job.id} + ', \'' + ${job.name} + '\')'">
                      <i class="fas fa-paper-plane"></i> Ứng tuyển
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No jobs found message -->
        <div th:if="${jobs == null or jobs.empty}" class="text-center py-5">
          <div class="card">
            <div class="card-body">
              <i class="fas fa-search fa-3x text-muted mb-3"></i>
              <h5 class="text-muted">Không tìm thấy việc làm nào</h5>
              <p class="text-muted">Hãy thử tìm kiếm với từ khóa khác hoặc điều chỉnh bộ lọc</p>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <nav th:if="${totalPages > 1}" aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
              <a class="page-link" th:href="@{/candidate/jobs(keyword=${keyword}, page=${currentPage - 1})}">Previous</a>
            </li>

            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                class="page-item" th:classappend="${i == currentPage} ? 'active'">
              <a class="page-link" th:href="@{/candidate/jobs(keyword=${keyword}, page=${i})}" th:text="${i + 1}">1</a>
            </li>

            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
              <a class="page-link" th:href="@{/candidate/jobs(keyword=${keyword}, page=${currentPage + 1})}">Next</a>
            </li>
          </ul>
        </nav>

      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

<script>
  // JavaScript functions for interactivity
  function clearFilters() {
    // Clear all filter inputs
    document.querySelectorAll('input[name="salary"]').forEach(input => input.checked = false);
    document.querySelectorAll('input[name="experience"]').forEach(input => input.checked = false);
    document.getElementById('keyword').value = '';

    // Reload page without filters
    window.location.href = '/candidate/jobs';
  }

  function applyFilters() {
    // Get current form and submit
    document.getElementById('jobSearchForm').submit();
  }

  function saveJob(jobId) {
    // Make AJAX request to save job
    fetch(`/candidate/jobs/${jobId}/save`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.status === 'success') {
                alert('Đã lưu việc làm thành công!');
              } else {
                alert(data.message || 'Có lỗi xảy ra!');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Có lỗi xảy ra khi lưu việc làm!');
            });
  }

  function quickApply(jobId, jobName) {
    if (confirm(`Bạn có muốn ứng tuyển vào vị trí "${jobName}"?`)) {
      // Make AJAX request to apply for job
      fetch(`/candidate/jobs/${jobId}/apply`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
          'applicantName': 'Candidate Name', // Should get from session or form
          'applicantEmail': 'candidate@email.com', // Should get from session or form
          'applicantPhone': '0123456789', // Should get from form
          'coverLetter': 'Tôi quan tâm đến vị trí này.'
        })
      })
              .then(response => response.json())
              .then(data => {
                if (data.status === 'success') {
                  alert('Ứng tuyển thành công!');
                } else {
                  alert(data.message || 'Có lỗi xảy ra!');
                }
              })
              .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra khi ứng tuyển!');
              });
    }
  }

  // Sort functionality
  document.getElementById('sortBy').addEventListener('change', function() {
    const sortValue = this.value;
    const url = new URL(window.location);
    url.searchParams.set('sortBy', sortValue);
    window.location.href = url.toString();
  });
</script>

</body>
</html>